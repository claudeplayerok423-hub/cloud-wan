# CLAUDE.md — cloud-wan

Инструкции для Claude Code при работе с этим репозиторием.

---

## Правила работы

- **Никаких секретов в репозитории.** Токены, пароли, ключи — только в `.env`. `.env` никогда не коммитится.
- **Всё через коммиты и PR.** Прямой пуш в `main` запрещён. Изменения идут через ветку → коммит → PR.
- **Аккуратные изменения.** Не трогать то, о чём не просили. Минимальный diff, понятные коммит-сообщения.
- **Команды — через tmux.** Все shell-команды выполнять в tmux-сессии, чтобы процессы жили независимо от терминала.
- **Перед изменением — прочитать файл.** Не предлагать правки вслепую.

### Работа с секретами

- `.env` содержит секреты (токены, ключи API). Он уже в `.gitignore` — не добавлять в индекс вручную.
- Если нужна новая переменная — добавить в `.env` локально и задокументировать в `.env.example` (без значений).
- При подозрении, что секрет попал в историю git — немедленно ротировать токен.

### Коммиты

```
git checkout -b feat/short-description
# ... изменения ...
git add <конкретные файлы>
git commit -m "feat: краткое описание"
gh pr create
```

---

## Архитектура

> Проект находится на начальном этапе. Раздел будет дополняться по мере развития.

**cloud-wan** — управление и мониторинг WAN/облачной сетевой инфраструктуры.

```
cloud-wan/
├── .env              # секреты (не в репо)
├── .env.example      # шаблон переменных (в репо, без значений)
├── .gitignore
├── CLAUDE.md         # этот файл
└── README.md
```

Ключевые переменные окружения (см. `.env`):
- `GITHUB_PAT` — Personal Access Token для GitHub API

---

## Команды разработки

Все команды выполнять в tmux. Создать сессию:

```bash
tmux new -s cloud-wan
# или подключиться к существующей:
tmux attach -t cloud-wan
```

### Основные операции

```bash
# Статус репозитория
git status

# Создать ветку для задачи
git checkout -b feat/имя-задачи

# Посмотреть открытые PR
gh pr list

# Посмотреть статус CI
gh run list
```

### Переменные окружения

```bash
# Загрузить .env в текущую сессию
set -a && source .env && set +a
```

---

## Деплой на этот сервер

**Сервер:** `oswuyfaafy` · пользователь: `dev` · OS: Ubuntu, kernel 6.8

### Процедура деплоя

1. Убедиться, что PR смёржен в `main`:
   ```bash
   gh pr merge <номер> --squash
   ```

2. Открыть tmux-сессию на сервере:
   ```bash
   tmux new -s deploy
   # или
   tmux attach -t deploy
   ```

3. Получить изменения:
   ```bash
   cd /home/dev/projects/cloud-wan
   git pull origin main
   ```

4. Применить изменения (команды будут уточнены по мере появления сервисов).

5. Проверить работу и зафиксировать результат в PR/issue.

### Откат

```bash
# Посмотреть историю
git log --oneline -10

# Откатиться к коммиту
git checkout <commit-hash>
```

### Важно

- Деплой только из ветки `main` после ревью.
- `.env` на сервере обновляется вручную — не перезаписывать автоматически.
- Перед деплоем убедиться, что нет несохранённых изменений: `git status`.
